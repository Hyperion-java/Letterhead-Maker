<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Letterhead PDF Generator</title>
  <style>
    :root { --card-bg:#fff; --accent:#0b84ff; }
    body {
      font-family: Arial, Helvetica, sans-serif;
      background:#f3f6fb;
      margin:0; padding:16px;
      color:#0b2540;
    }
    .container { max-width:900px; margin:0 auto; }
    .card {
      background:var(--card-bg);
      padding:18px;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(12,24,40,0.06);
      margin-bottom:20px;
    }
    h1 { margin:0 0 12px; font-size:20px; }
    label { display:block; font-weight:600; margin:12px 0 6px; }
    input[type=text], textarea {
      width:100%;
      padding:10px;
      border-radius:8px;
      border:1px solid #dfe7f2;
      font-size:14px;
      resize:vertical;
      box-sizing:border-box;
    }
    textarea { min-height:180px; }
    .controls { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:12px; }
    button {
      background:var(--accent);
      color:#fff;
      border:0;
      padding:10px 14px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
    }
    button.secondary {
      background:#edf1f8;
      color:#0b2540;
    }
    footer {
      margin-top:14px;
      font-size:13px;
      color:#556674;
      text-align:center;
    }
    .small { font-size:12px; color:#6b7a89; }
    @media (max-width:600px){
      body { padding:12px; }
      button { width:100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Letterhead PDF Generator</h1>
      <p class="small">Automatically uses <strong>letterhead.png</strong> from this folder. Add one or more documents below and generate all PDFs.</p>
      
      <div id="entries"></div>

      <div class="controls">
        <button id="addEntry">+ Add Document</button>
        <button id="generateAll">Generate All PDFs</button>
      </div>

      <footer>Tip: Keep <code>letterhead.png</code> in the same folder as this HTML. Works on desktop and mobile.</footer>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    (async function(){
      const { jsPDF } = window.jspdf;
      const entriesDiv = document.getElementById('entries');
      const btnAdd = document.getElementById('addEntry');
      const btnGenerate = document.getElementById('generateAll');

      // Auto-load letterhead.png from current directory
      let letterheadUrl = 'letterhead.png';
      let letterheadImg = null;

      try {
        letterheadImg = await loadImage(letterheadUrl);
      } catch (e) {
        alert('⚠️ Could not load letterhead.png — make sure it’s in the same directory as this HTML.');
      }

      btnAdd.addEventListener('click', addEntry);
      btnGenerate.addEventListener('click', generateAll);

      // Add first entry by default
      addEntry();

      function addEntry(){
        const index = entriesDiv.children.length + 1;
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <label>Document ${index} Title (used for filename)</label>
          <input type="text" class="docTitle" placeholder="e.g. Project Proposal" />

          <label>Document ${index} Text</label>
          <textarea class="docText" placeholder="Type or paste your text..."></textarea>

          <button class="secondary removeEntry">Remove</button>
        `;
        card.querySelector('.removeEntry').addEventListener('click', () => card.remove());
        entriesDiv.appendChild(card);
      }

      async function generateAll(){
        const docs = [...entriesDiv.querySelectorAll('.card')].map(card => ({
          title: card.querySelector('.docTitle').value.trim() || 'document',
          text: card.querySelector('.docText').value.trim()
        }));

        if (!letterheadImg) return alert('Please ensure letterhead.png is accessible.');
        if (docs.length === 0) return alert('Add at least one document.');
        if (docs.every(d => !d.text)) return alert('Please enter text for at least one document.');

        for (const doc of docs){
          if (!doc.text) continue;
          await generatePDF(doc.title, doc.text);
        }

        alert('✅ All PDFs generated!');
      }

      async function generatePDF(title, text){
        const pdf = new jsPDF({ unit: 'mm', format: 'a4' });
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();

        const marginLeft = 20, marginRight = 20, marginTop = 60, marginBottom = 30;
        const usableWidth = pageWidth - marginLeft - marginRight;
        const usableHeight = pageHeight - marginTop - marginBottom;

        pdf.setFont('helvetica');
        pdf.setFontSize(13);

        const lines = pdf.splitTextToSize(text, usableWidth);
        const lineHeightMm = (13 * 1.3) * 0.352777778;
        const linesPerPage = Math.floor(usableHeight / lineHeightMm);

        const imgDataUrl = await imageToDataUrl(letterheadImg);

        for (let p = 0; p < Math.ceil(lines.length / linesPerPage); p++) {
          if (p > 0) pdf.addPage();
          pdf.addImage(imgDataUrl, 'PNG', 0, 0, pageWidth, pageHeight);
          const start = p * linesPerPage;
          const end = Math.min(start + linesPerPage, lines.length);
          let cursorY = marginTop;
          for (let i = start; i < end; i++) {
            pdf.text(lines[i], marginLeft, cursorY, { maxWidth: usableWidth, align: "justify" });
            cursorY += lineHeightMm;
          }
        }

        pdf.save(`${title.replace(/\s+/g, '_')}.pdf`);
      }

      function loadImage(url){
        return new Promise((res, rej) => {
          const img = new Image();
          img.crossOrigin = 'anonymous';
          img.onload = () => res(img);
          img.onerror = rej;
          img.src = url;
        });
      }

      function imageToDataUrl(img){
        const canvas = document.createElement('canvas');
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        return canvas.toDataURL('image/png');
      }
    })();
  </script>
</body>
</html>
